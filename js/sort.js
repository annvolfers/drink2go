import{isOutsideClick,isEscapeKey}from"./util.js";const sortForm=document.querySelector(".sort"),select=sortForm.querySelector(".sort__select"),customSelectClass=".custom-select",customSelect=document.querySelector("#custom-select").content.querySelector(".custom-select").cloneNode(!0),customSelectButton=customSelect.querySelector(".custom-select__button"),customList=customSelect.querySelector(".custom-select__list"),customItem=customList.querySelector(".custom-select__item");let selectedCustomOptionNumber;const openedCustomSelectClass="custom-select--opened",customOptionsSelector=".custom-select__option",selectedCustomOptionClass="custom-select__option--selected",customOptions=[];function createCustomSelect(){customItem.remove();for(const e of select.options){const t=customItem.cloneNode(!0),s=t.querySelector(customOptionsSelector);s.textContent=e.textContent,e.selected&&(s.classList.add(selectedCustomOptionClass),customSelectButton.textContent=e.textContent,selectedCustomOptionNumber=e.index),customOptions.push(s),customList.appendChild(t)}sortForm.append(customSelect)}function openOptions(){customSelect.classList.add("custom-select--opened"),document.addEventListener("click",outsideClickHandler),document.addEventListener("keydown",escKeydownHandler)}function closeOptions(){customSelect.classList.remove("custom-select--opened"),document.removeEventListener("click",outsideClickHandler),document.removeEventListener("keydown",escKeydownHandler)}function setSelectedOption(e){customOptions[selectedCustomOptionNumber].classList.remove(selectedCustomOptionClass),customOptions[e].classList.add(selectedCustomOptionClass),customSelectButton.textContent=customOptions[e].textContent,select.selectedIndex=e,selectedCustomOptionNumber=e,closeOptions(),sortForm.submit()}function outsideClickHandler(e){isOutsideClick(e,".custom-select")&&closeOptions()}function escKeydownHandler(e){isEscapeKey(e)&&(e.preventDefault(),closeOptions())}sortForm.classList.remove("sort--nojs"),select.removeAttribute("form"),select.tabIndex=-1,createCustomSelect(),customSelectButton.addEventListener("click",(()=>customSelect.classList.contains("custom-select--opened")?closeOptions():openOptions())),customList.addEventListener("click",(e=>{e.target.closest(customOptionsSelector)&&customOptions.forEach(((t,s)=>{e.target===t&&setSelectedOption(s)}))}));